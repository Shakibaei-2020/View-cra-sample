<app-administrateur></app-administrateur>
<br><br><br>

<div class="container">
    <div>
        <button class="img-fluid bouttonMenu">
            <i class="fas fa-project-diagram"></i>
        </button>

        <!-- <button (click)="goToAccueil()" class="img-fluid buttonAdd ">
            <img class="img1" src="https://image.flaticon.com/icons/png/512/1276/1276491.png">
        </button> -->

    
<!-- 
        <button class="img-fluid buttonAdd ">
            <img (click)="goToAddProject()" class="img1"
                src="https://image.flaticon.com/icons/png/512/1632/1632686.png">
        </button>-->
        <h2 class="page">Gestion des projets</h2>
    </div>
    <hr>



    <div>
        <div class="container mt-3"><br>


            <form class="example" action="action_page.php" #addCollabForm="ngForm" (ngSubmit)="searchProjectByName()">
                <div class="container">


                    <div class="row">

                        <div class="col-sm-4">
                            <span>Prénom du collaborateur</span>

                            <input type="text" placeholder="Nom du projet" autocomplete="off" required
                                [(ngModel)]="searchByProjectName" name="projectNameSearch">
                        </div>

                        <div class="col-sm-4">
                            <span>Nom de la mission</span>
                            <input type="text" placeholder="Nom de la mission" autocomplete="off" required
                                [(ngModel)]="searchByMissionName" name="searchByMissionName">
                        </div>

                        <div class="col-sm-4">
                            <span>Nom du client</span>
                            <input type="text" placeholder="Nom du client" autocomplete="off" required
                                [(ngModel)]="searchByClientName" name="searchByClientName">
                        </div>

                        <div class="container"><br>

                            <button class="btnSearch gb2 gb-bordered hover-slide" id="gb79" type="submit">
                                <p>Chercher</p>
                            </button>
                        </div>

                        <div class="col-sm-8"><br>
                        </div>

                    </div>
                </div>
            </form>

            <div *ngIf="projects">

                <br><br>
                <h2>Résultat : {{nbResultat}} résultat trouvé pour cette recherche.</h2>
                <table class="table table-striped table-bordered">
                    <thead>
                        <tr>
                            <th>
                                <p class="titreTable">Nom du client </p>
                            </th>
                            <th>
                                <p class="titreTable">Nom de la mission</p>
                            </th>
                            <th>
                                <p class="titreTable">Nom du projet </p>
                            </th>


                            <th>
                                <p class="commande titreTable">Action</p>
                            </th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr *ngFor="let project of projects; let indexOfelement = index">
                            <td>
                                <p class="contentTable">{{project.prenomClient}}</p>
                            </td>
                            <td>
                                <p class="contentTable">{{project.missionTitle}}</p>

                            </td>

                            <td>
                                <p class="contentTable">{{project.projectTitle}}</p>

                            </td>
                            <td>
                                <button type="button" class="btnEditer gb2 gb-bordered hover-slide" id="gb79" data-toggle="modal"
                                    [attr.data-target]=" '#myProjectModal-' + indexOfelement"
                                    (click)="modelInfo(project.id)">Éditer</button>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <div *ngFor="let project of projects; let indexOfelement =index;">



                <div class="modal fade" id="myProjectModal-{{indexOfelement}}" role="dialog">
                    <div class="modal-dialog modal-xl modal-dialog-centered" >
                        <!-- Modal content-->
                        <div class="modal-content">
                            <div class="modal-header">
                                <h2> Gestion du projet {{project.projectTitle}} </h2>
                                <div class="toHide">
                                    <input type="text" value="{{project.id}}" name="projectId-{{indexOfelement}}"
                                        id="projectId-{{indexOfelement}}" disabled>
                                </div>
                            </div>


                            <div class="modal-body ">

                                <div class="container">
                                    <span>Prénom du collaborateur : </span>
                                    <div class="d-table-cell w-100">
                                        <input class="modal-inputText" autocomplete="off" required
                                            [(ngModel)]="collaboratorInputLastName.lastName" name="lastName">
                                    </div>

                                    <div class="d-table-cell align-middle">
                                        <button class="btnModal2 btnViolet" (click)="searchOneCollab()">Chercher</button>
                                    </div>
                                </div>


                                <div *ngIf="searchedCollabs">

                                    <div class="container">
                                        <h2>Collaborateur(s) : {{nbResultatRecherche}} </h2>
                                        <span class="affectNotDone">{{affectNotDone}}</span>
                                        <table class="table table-striped table-bordered">
                                            <thead>
                                                <tr>
                                                    <th>
                                                        <p class="titreTable">Nom </p>
                                                    </th>
                                                    <th>
                                                        <p class="titreTable">Prénom</p>
                                                    </th>
                                                    <th>
                                                        <p class="titreTable">Adresse mail</p>
                                                    </th>

                                                    <th>
                                                        <p class="commande titreTable">Action</p>
                                                    </th>
                                                </tr>
                                            </thead>
                                            <tbody>
                                                <tr
                                                    *ngFor="let collaborator of searchedCollabs; let indexOfelement = index">
                                                    <td>
                                                        <p class="contentTable">{{collaborator.firstName}}</p>
                                                    </td>
                                                    <td>
                                                        <p class="contentTable">{{collaborator.lastName}}</p>
                                                    </td>
                                                    <td>
                                                        <p class="contentTable">{{collaborator.email}}</p>
                                                    </td>


                                                    <td>
                                                        <!-- <button type="button" class="btnTab"  (click)="modelInfo(collaborator.id)">Affecter</button> -->
                                                        <button type="button" class="btn btnViolet  btn-block"
                                                            (click)="affectCollabToProject(project.id,collaborator.id,searchedCollabs,collaborator)">Affecter</button>
                                                    </td>
                                                </tr>
                                            </tbody>
                                        </table>
                                    </div>
                                </div>

                                <br>
                                <hr><br>
                                <div class="container">
                                    <h2> Collaborateur(s) sur le projet : {{nbCollabOnProject}} </h2>

                                    <div *ngIf="allCollabOfProject">
                                        <table class="table table-striped table-bordered">
                                            <thead>
                                                <tr>
                                                    <th>
                                                        <p class="titreTable">Nom </p>
                                                    </th>
                                                    <th>
                                                        <p class="titreTable">Prénom</p>
                                                    </th>
                                                    <th>
                                                        <p class="titreTable">Adresse mail</p>
                                                    </th>

                                                    <th>
                                                        <p class="commande titreTable">Action</p>
                                                    </th>
                                                </tr>
                                            </thead>
                                            <tbody>
                                                <tr
                                                    *ngFor="let collaborator of allCollabOfProject; let indexOfelement = index">

                                                    <td>
                                                        <p class="contentTable">{{collaborator.firstName}}</p>
                                                    </td>
                                                    <td>
                                                        <p class="contentTable">{{collaborator.lastName}}</p>
                                                    </td>

                                                    <td>
                                                        <p class="contentTable">{{collaborator.email}}</p>
                                                    </td>
                                                    <td>
                                                        <button type="button" class="btn btnViolet btn-block"
                                                        data-dismiss="myProjectModal-indexOfelement"  (click)="deleteCollabOfProject(project.id,collaborator.id,allCollabOfProject,collaborator)">Supprimer</button>

                                                    </td>
                                                </tr>
                                            </tbody>
                                        </table>
                                    </div>
                                </div>

                                <br>

                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>