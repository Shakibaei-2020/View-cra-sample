<app-utilisateur></app-utilisateur>


<div class="container">

  <div class="">
    <div class="">
      <br>
      <div class="row">

        <div class="bio-row">
          <div class="inputbox mt-1"><span class="input-title">Coût HT :</span>
            <div class="input-group-prepend">
              <input autocomplete="off" type="text" id="costHTHTML  " requireds [(ngModel)]="NewExpense.costHT" name="expense.costHT" >
              <span class="input-group-text devise">€</span> 
            </div>
          </div>


          <div class="inputbox mt-1">
            <span>Facturable :</span><br>
            <select class="form-input" id="billiableHTML" required [(ngModel)]="NewExpense.billable" name="expense.billable">
              <option value="true">Oui</option>
              <option value="false">Non</option>
            </select>
          </div>

          <div class="inputbox mt-1">
            <span>Nature des frais :</span><br>
      
            <select class="form-input" required [(ngModel)]="NewExpense.typeExpense" name="NewExpense.typeExpense" >
              <option *ngFor="let typeExpense of allTypeExpense"  [ngValue]="typeExpense" >{{typeExpense.type}}
              </select>


          </div>
        </div>

        <div class="bio-row">
          <div class="inputbox mt-1">
            <span class="input-title">Coût TVA :</span>
            <div class="input-group-prepend">
              <input autocomplete="off" id="costTVAHTML" type="text" required [(ngModel)]="NewExpense.costTVA">
              <span class="input-group-text devise">€</span>
            </div>
          
        
          </div>

          <div class="inputbox mt-1">
            <span class="input-title">Coût TTC :</span>

            <div class="input-group-prepend">
              <input autocomplete="off" id="costTTCHTML"   required [(ngModel)]="NewExpense.costTVA" type="text" disabled>

              <span class="input-group-text devise">€</span>
            </div>
          </div>

          <div class="inputbox mt-1">
            <span class="input-title">Date de frais :</span>
            <input class="modal-input" type="date"    [(ngModel)]="NewExpense.dateExpense"  name="NewExpense.dateExpense">

          </div>

          <br>

          <div class="row">
            <div class="col-sm-6">
              <button class=" btnForm gb gb-bordered hover-slide" id="gb9" (click)="retour()">Retour</button>
  
            </div>
            <div class="col-sm-6">
              <button class=" btnForm gb gb-bordered hover-slide" id="gb9" data-toggle="modal" data-target="#updateModal">Ajouter</button>
            </div>
          </div>

          
        </div>




        


        <div class="bio-row">




          <div class="modal fade" id="updateModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel"
            aria-hidden="true">
            <div class="modal-dialog" role="document">
              <div class="modal-content">
                <div class="modal-header">
                  <h5 class="modal-title" id="exampleModalLabel">Alert update</h5>
                  <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                  </button>
                </div>
                <div class="modal-body">
                  Êtes vous sur de vouloir mettre à jour ?
                </div>
                <div class="modal-footer">
                  <button type="button" class="btn btn-secondary" data-dismiss="modal">Annuler</button>
                  <button type="button" class="btn btn-primary" data-dismiss="modal"
                    (click)="addExpense()">Ajouter</button>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
    <div>
     
      <h2>Vos demandes :</h2>
      <table class="table table-striped table-bordered">
        <thead>
          <tr >
            <th>
              <p>Date de la demande</p>
            </th>
            <th>
              <p>Date de frais</p>
            </th>
            <th>
              <p>Catégorie</p>
            </th>

            <th>
              <p>Coût total</p>
            </th>
            <th>
              <p>État de la demande</p>
            </th>
            <th>
              <p class="Action">Action</p>
            </th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let expense of expensesOfCollab; let indexOfelement =index;">
            <td>{{expense.dateRequest | date: 'dd/MM/yyyy'}}</td>
            <td>{{expense.dateExpense | date: 'dd/MM/yyyy' }}</td>
            <td>{{expense.typeExpense.type}}</td>
            <td>{{expense.costTTC}} €</td>
            <td>{{expense.status}}</td>

            <button type="button" class=" btnEditer  gb gb-bordered hover-slide" id="gb9" (click)="onInitModal(expense)" data-toggle="modal" [attr.data-target]=" '#myExpenseModal-' + indexOfelement" >Éditer</button>

          </tr>
        </tbody>

      </table>



          <!-- Modal -->
    <div *ngFor="let expense of expensesOfCollab; let indexOfelement =index;">

      <div class="modal fade " id="myExpenseModal-{{indexOfelement}}"   role="dialog">
        <div class="modal-dialog modal-xl modal-dialog-centered">
          <!-- Modal content-->
          <div class="modal-content">
            <div class="modal-header">
              <h3>Gestion de la demande de frais de {{expense.nomCollab}} {{expense.prenomCollab}}  du {{expense.dateRequest  | date: 'dd/MM/yyyy'}}</h3>
              <div class="toHide">
                 <input type="text" value="{{expense.id}}" name="expenseRequestId-{{indexOfelement}}" id="expenseRequestId-{{indexOfelement}}" disabled> 
              </div>
            </div>
            <div class="modal-body">
              <div class="row">

                <!-- Colonne 1-->
                <div class="col-sm-6">

                  <div class="inputbox mt-1">
                    <span> Cout HT : </span><br>
                    <input class="modal-input"  [(ngModel)]="costHTOfExpense"   autocomplete="off"   type="number"  value="{{expense.costHT}}" name="expenseCostHT-{{indexOfelement}}" id="expenseCostHT-{{indexOfelement}}" >
                  </div>

                  <div class="inputbox mt-1">
                    <span> Cout TTC :</span><br>
                    <input class="modal-input"   [(ngModel)]="costTTCOfExpense"   autocomplete="off"  type="number" value="" name="newCostTTC-{{indexOfelement}}" id="newCostTTC-{{indexOfelement}}"  placeholder="{{TTCvalue}}" disabled>
                  </div>
                 
                  <div class="inputbox mt-1">
                    <span> Facturable : </span><br>
                    <select class="modal-input"  [(ngModel)]="billableOfExpense" name="expenseBillable-{{indexOfelement}}" id="expenseBillable-{{indexOfelement}}">
                      <option hidden value="" disabled selected>{{expense.billableFR}} </option>
                      <option value="true">oui</option>
                      <option value="false">non</option>
                    </select>
                  </div>

                  <div class="inputbox mt-1">
                    <span> Date de frais : </span><br>
                    <input class="modal-input" type="date"    [(ngModel)]="dateOfExpense"   value="{{expense.oldDateExpense}}" name="dateExpense-{{indexOfelement}}" id="dateExpense-{{indexOfelement}}">
                  </div>

                </div>

                <!-- Colonne 2-->
                <div class="col-sm-6">

                  <div class="inputbox mt-1">
                    <span> CoutTVA : </span><br>
                    <input class="modal-input" autocomplete="off"   [(ngModel)]="costTVAOfExpense"  type="number" value="{{expense.costTVA}}"   name="expenseCostTVA-{{indexOfelement}}" id="expenseCostTVA-{{indexOfelement}}">
                  </div>

                  <div class="inputbox mt-1 toHide" >
                    <span> Date demande : {{expense.dateRequest  | date: 'dd/MM/yyyy'}}</span><br>
                    <input class="modal-input" type="date"   [(ngModel)]="dateRequestOfExpense"    name="dateExpenseRequest-{{indexOfelement}}" id="dateExpenseRequest-{{indexOfelement}}" disabled>
                  </div>

                  <div class="inputbox mt-1">
                    <span> Type : </span><br>
                    <select class="modal-input"   [(ngModel)]="typeOfExpense"   name="expenseType-{{indexOfelement}}" id="expenseType-{{indexOfelement}}">
                      <option hidden value="" disabled selected>{{expense.typeExpense.type}} </option>

                      <option *ngFor="let allExpenseTypes of allExpenseType" value="{{allExpenseTypes.id}}">{{allExpenseTypes.type}}
                    </select>
                  </div>

                  <div class="inputbox mt-1">
                    <span> État de la demande :</span><br>
                    <select class="modal-input"   disabled [(ngModel)]="statusOfExpense"    name="expenseStatus-{{indexOfelement}}" id="expenseStatus-{{indexOfelement}}">
                      <option hidden value="" disabled selected>{{expense.status}} </option>
                      <option *ngFor="let statue of status" value={{statue}}>{{statue}}</option>
                    </select>
                  </div>

                </div>
                <div class="container"><br>
                  <p class="validation" >{{validation}}</p>
                  <p class="notValidation">{{notValidation}}</p>
                </div>
              </div>
              <div class="modal-footer ">

        
                <button class="btn btnModal "  (click)="updateExpense()">Maj</button>
                <button class="btn btnModal " type="submit"data-dismiss="modal"  (click)="deleteExpenseById()">Supprimer</button>
              </div>


            </div>
          </div>
        </div>
      </div>
    </div>



      <!-- <button (click)="Envoyer()">test</button>
        <button (click)="EnvoyerMail()">send Mail</button>
        <a href="mailto:mohashakibaei@outlook.fr">Contact via E-mail</a> -->
    </div>





  </div>